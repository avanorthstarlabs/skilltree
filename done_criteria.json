{
  "checks": [
    {
      "name": "package.json exists",
      "type": "file_exists",
      "path": "package.json"
    },
    {
      "name": "App directory exists",
      "type": "file_exists",
      "path": "app"
    },
    {
      "name": "No TODO markers in source",
      "type": "no_markers",
      "path": "app"
    }
  ],
  "validation_commands": [
    ["npm", "run", "build"]
  ],
  "feature_tasks": [
    {
      "id": "storage-layer",
      "name": "File-backed JSON storage layer",
      "description": "Implement lib/store.js with atomic read/write for workflows, proposals, approvals, receipts. Functions: getWorkflows, getWorkflowBySlug, getProposals, getProposalById, createProposal, updateProposal, getApprovals, getApprovalByProposalId, createApproval, getReceipts, getReceiptByProposalId, createReceipt.",
      "required_files": ["lib/store.js"],
      "check_patterns": ["getWorkflows", "createProposal", "createApproval", "createReceipt", "readFileSync", "writeFileSync"]
    },
    {
      "id": "seed-workflows",
      "name": "Seed 5 realistic workflows with schemas",
      "description": "Create data/workflows.json with 5 workflows: bug-triage, weekly-status, qa-checklist, onboarding-guide, incident-summary. Each has id, slug, name, description, category, tags, icon, inputs_schema with typed fields.",
      "required_files": ["data/workflows.json"],
      "check_patterns": ["bug-triage", "weekly-status", "qa-checklist", "onboarding-guide", "incident-summary", "inputs_schema"]
    },
    {
      "id": "input-validation",
      "name": "Input validation against workflow schema",
      "description": "Implement lib/validate.js that validates input_payload against workflow inputs_schema. Check required fields, string types, minLength, enum options, boolean. Return { valid, errors[] }.",
      "required_files": ["lib/validate.js"],
      "check_patterns": ["validateInputs", "valid", "errors"]
    },
    {
      "id": "simulator",
      "name": "Deterministic workflow simulator",
      "description": "Implement lib/simulator.js with simulateExecution(workflow, proposal) producing deterministic outputs for each workflow type. Also createSignedIntent(proposal, approval) producing SHA-256 signed canonical JSON.",
      "required_files": ["lib/simulator.js"],
      "check_patterns": ["simulateExecution", "createSignedIntent", "sha256", "output_payload"]
    },
    {
      "id": "api-workflows",
      "name": "Workflows API endpoints",
      "description": "GET /api/workflows with search/category/tag filtering. GET /api/workflows/[slug] with 404 handling.",
      "required_files": ["app/api/workflows/route.js", "app/api/workflows/[slug]/route.js"],
      "check_patterns": ["getWorkflows", "getWorkflowBySlug", "NextResponse"]
    },
    {
      "id": "api-proposals",
      "name": "Proposals API endpoints",
      "description": "POST /api/proposals creates proposal with schema validation. GET /api/proposals lists with optional status filter. GET /api/proposals/[id] returns proposal with linked approval/receipt.",
      "required_files": ["app/api/proposals/route.js", "app/api/proposals/[id]/route.js"],
      "check_patterns": ["createProposal", "validateInputs", "getProposals", "getProposalById"]
    },
    {
      "id": "api-approvals",
      "name": "Approvals API with simulator integration",
      "description": "POST /api/approvals accepts proposal_id, decision, rationale. Enforces state machine (pending only), rationale min 10 chars, idempotency. On approve: simulate execution, create receipt, update proposal to executed.",
      "required_files": ["app/api/approvals/route.js"],
      "check_patterns": ["createApproval", "simulateExecution", "createReceipt", "updateProposal", "rationale"]
    },
    {
      "id": "api-receipts-metrics",
      "name": "Receipts and Metrics API endpoints",
      "description": "GET /api/receipts returns all receipts sorted by date. GET /api/metrics returns aggregate counts, approval rate, breakdown by workflow.",
      "required_files": ["app/api/receipts/route.js", "app/api/metrics/route.js"],
      "check_patterns": ["getReceipts", "approval_rate", "by_workflow"]
    },
    {
      "id": "layout-nav",
      "name": "Shared layout with sticky navigation",
      "description": "app/layout.js with sticky top nav bar showing brand (⚡ Workflow Marketplace), nav links (Catalog, Approvals, Receipts, Metrics). Import globals.css.",
      "required_files": ["app/layout.js"],
      "check_patterns": ["topnav", "Catalog", "Approvals", "Receipts", "Metrics", "globals.css"]
    },
    {
      "id": "page-catalog",
      "name": "Catalog page with search and filtering",
      "description": "app/page.js: client-side catalog with search bar, category filter chips, workflow card grid. Cards show icon, name, description, category badge, View CTA. Empty state when no results.",
      "required_files": ["app/page.js"],
      "check_patterns": ["use client", "search", "category", "workflow-card", "card-grid", "fetchWorkflows"]
    },
    {
      "id": "page-workflow-detail",
      "name": "Workflow detail page with dynamic run form",
      "description": "app/workflows/[slug]/page.js: Shows workflow info, renders inputs_schema as dynamic form with field types (text, textarea, select, checkbox), validation, submit creates proposal. Success state with proposal ID.",
      "required_files": ["app/workflows/[slug]/page.js"],
      "check_patterns": ["use client", "form", "handleSubmit", "input_payload", "workflow_slug", "renderField"]
    },
    {
      "id": "page-approvals",
      "name": "Approval queue with decision modal",
      "description": "app/approvals/page.js: Filterable list of proposals with status badges, table layout, approve/reject buttons. Modal with rationale textarea (min 10 chars). Status filter chips.",
      "required_files": ["app/approvals/page.js"],
      "check_patterns": ["use client", "handleDecision", "rationale", "Approve", "Reject", "badge"]
    },
    {
      "id": "page-proposal-detail",
      "name": "Proposal detail page with audit info",
      "description": "app/approvals/[id]/page.js: Shows proposal info, input payload (JSON viewer), approval decision details, receipt output if executed. Grid layout.",
      "required_files": ["app/approvals/[id]/page.js"],
      "check_patterns": ["use client", "proposal", "approval", "receipt", "json-viewer"]
    },
    {
      "id": "page-receipts",
      "name": "Receipts log with expandable payloads",
      "description": "app/receipts/page.js: List of receipts with expand/collapse for output payload. Shows run status, signed intent hash, timestamps.",
      "required_files": ["app/receipts/page.js"],
      "check_patterns": ["use client", "receipts", "output_payload", "signed_intent", "expanded"]
    },
    {
      "id": "page-metrics",
      "name": "Metrics dashboard with KPI cards",
      "description": "app/metrics/page.js: KPI cards for total proposals, pending, approval rate, executed, rejected, total receipts. Table breakdown by workflow.",
      "required_files": ["app/metrics/page.js"],
      "check_patterns": ["use client", "metric-card", "metric-value", "approval_rate", "by_workflow"]
    },
    {
      "id": "styling",
      "name": "Premium CSS design system",
      "description": "app/globals.css with complete design system: CSS variables for colors/spacing, topnav styles, card/card-grid, badges (pending/approved/rejected/executed), buttons, forms, tables, metric cards, search bar, JSON viewer, empty states, responsive breakpoints.",
      "required_files": ["app/globals.css"],
      "check_patterns": ["--color-accent", "topnav", "card-grid", "badge-pending", "badge-approved", "btn-primary", "form-input", "metric-card", "json-viewer", "empty-state"]
    },
    {
      "id": "ui-css-foundations",
      "name": "CSS focus states, skeleton loading, and modal styles",
      "description": "Upgrade globals.css: Add :focus-visible styles with accent ring (box-shadow: 0 0 0 3px rgba(67,97,238,0.15)) on ALL interactive elements (.btn, .nav-link, .chip, .form-input, .form-select, .form-textarea, a). Add .skeleton class with pulse animation for loading placeholders. Add .modal-backdrop with rgba(0,0,0,0.5) and backdrop-filter: blur(4px). Add .modal-content with white bg, --radius-lg, --shadow-lg, max-width 480px, padding 24px. Add .error-banner class for inline error messages with retry. All card hover states must use var(--shadow-md) and translateY(-2px). Follow DESIGN_SYSTEM.md section 5 and 6 exactly.",
      "required_files": ["app/globals.css"],
      "check_patterns": ["focus-visible", "skeleton", "@keyframes", "modal-backdrop", "modal-content", "backdrop-filter", "error-banner", "translateY"]
    },
    {
      "id": "ui-catalog-polish",
      "name": "Catalog page: loading skeleton, error state, no inline styles",
      "description": "Refactor app/page.js: Replace 'Loading workflows...' text with skeleton placeholder cards (use .skeleton CSS class). Add error state with message and retry button when fetch fails (use .error-banner class). Remove ALL inline style={{}} attributes — use CSS classes from globals.css instead. Page must have h1 with className='page-title' and subtitle paragraph. Cards must use className only, no inline styles. Ensure empty state uses .empty-state class with icon, heading, and description.",
      "required_files": ["app/page.js"],
      "check_patterns": ["skeleton", "error", "setError", "Retry", "page-title", "empty-state"]
    },
    {
      "id": "ui-detail-polish",
      "name": "Workflow detail page: loading, error, form labels, no inline styles",
      "description": "Refactor app/workflows/[slug]/page.js: Replace 'Loading workflow...' with skeleton placeholders. Add error state with retry button on fetch failure. Remove ALL inline style={{}} — use CSS classes only. Every form input MUST have a visible <label> element above it (never placeholder-only). Required fields show ' *' after label. Form validation errors appear below inputs with .field-error class. Success state uses .empty-state class with checkmark icon.",
      "required_files": ["app/workflows/[slug]/page.js"],
      "check_patterns": ["skeleton", "error", "setError", "Retry", "label", "field-error"]
    },
    {
      "id": "ui-approvals-polish",
      "name": "Approvals page: modal accessibility, loading, error, no inline styles",
      "description": "Refactor app/approvals/page.js: Replace 'Loading proposals...' with skeleton rows. Add error state with retry. Remove ALL inline style={{}} — use CSS classes. Modal must use .modal-backdrop and .modal-content classes. Modal must close on Escape key (useEffect with keydown listener) and backdrop click. Modal rationale textarea must have visible label. Approve/Reject buttons must use .btn-success and .btn-danger classes. Status filter chips must use .chip class.",
      "required_files": ["app/approvals/page.js"],
      "check_patterns": ["skeleton", "error", "setError", "Retry", "modal-backdrop", "modal-content", "Escape", "btn-success", "btn-danger"]
    },
    {
      "id": "ui-proposal-detail-polish",
      "name": "Proposal detail page: loading, error, grid layout, no inline styles",
      "description": "Refactor app/approvals/[id]/page.js: Replace 'Loading...' with skeleton blocks. Add error state with retry button on fetch failure. Remove ALL inline style={{}} — use CSS classes (e.g. .detail-grid for the two-column layout, .section-title for h3 headings). Page header with h1 page-title and subtitle. JSON viewer sections use .json-viewer class. Empty sections show .empty-state.",
      "required_files": ["app/approvals/[id]/page.js"],
      "check_patterns": ["skeleton", "error", "setError", "Retry", "page-title", "detail-grid"]
    },
    {
      "id": "ui-receipts-polish",
      "name": "Receipts page: loading, error, no raw hex colors, no inline styles",
      "description": "Refactor app/receipts/page.js: Replace 'Loading receipts...' with skeleton rows. Add error state with retry. Remove ALL inline style={{}} — use CSS classes only. Remove any raw hex colors (like #f3f4f6) — use CSS variables via class names instead. Expand/collapse buttons use .btn-outline class. JSON payloads use .json-viewer class. Page header with h1 page-title and subtitle.",
      "required_files": ["app/receipts/page.js"],
      "check_patterns": ["skeleton", "error", "setError", "Retry", "page-title", "json-viewer"]
    },
    {
      "id": "ui-metrics-polish",
      "name": "Metrics page: loading, error, no inline styles",
      "description": "Refactor app/metrics/page.js: Replace 'Loading metrics...' with skeleton metric cards. Add error state with retry. Remove ALL inline style={{}} — use CSS classes. Metric cards use .metric-card class with hover elevation. KPI values use .metric-value class. Metric labels use .metric-label class. Table breakdown uses .data-table class. Page header with h1 page-title and subtitle. Empty state if no data.",
      "required_files": ["app/metrics/page.js"],
      "check_patterns": ["skeleton", "error", "setError", "Retry", "page-title", "metric-card"]
    }
  ]
}
